#!/usr/bin/ansible-playbook
---
- command: hostname

- name: "Pre tasks in local"
  hosts: localhost
  connection: "local"
  gather_facts: "no"
  tasks:
  - copy:
      src: /etc/ansible/remote_files/passwd/master.passwd.open_access_ubuntu16
      dest: /root/baas/master.passwd.open_access_ubuntu16
      # delegate_to: 127.0.0.1
      #remote_src: yes
      backup: yes
    tags: access

  - copy:
      src: /usr/lib/python2.7/site-packages/ansible/modules/custom_modules/gen_pass.py
      dest: /root/baas/gen_pass.py
      # delegate_to: 127.0.0.1
      #remote_src: yes
      backup: yes
    tags: access

  - name: Creating prod_users password file
    command: /usr/bin/python /root/baas/gen_pass.py
    #delegate_to: 127.0.0.1
    tags: access

  - name: check prod user file exists and not empty
    stat:
      path: /root/baas/prod_users
    register: file_details
    #delegate_to: localhost
    tags: access

- name: including plays
  include: k8s-workers.yml
  when: file_details.stat.size


- name: including plays
  include: shell-servers.yml
  when: file_details.stat.size
